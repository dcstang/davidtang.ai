# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a personal landing page for David Tang built as a containerized Go application serving a static Svelte website. The app is a SPA with dynamic content blocks (YouTube and LinkedIn) sourced from a small JSON document. It is deployed on Google Cloud Run Gen 1.

## Architecture

- **Backend**: Go HTTP server (`main.go`) serves static files from `dist` (SPA)
- **Frontend**: Svelte + Tailwind CSS (single page)
- **Dynamic content**: The SPA fetches `/content.json` to render:
  - Featured YouTube video + top 2 recent videos (thumbnails with click-to-play)
  - Single LinkedIn post (official embed iframe)
- **Consulting CTA**: Prominent link to `https://tangible.healthcare`
- **Build**: Multi-stage Docker (Node builds Svelte → Go binary serves static)
- **Deployment**: Google Cloud Run (container registry), fronted by GCLB

## Development Commands

```bash
# Install Node.js dependencies
npm install

# Start development server (Svelte only)
npm run dev

# Build Svelte application for production
npm run build

# Test Go server locally (requires built dist folder)
go run main.go

# Build Docker image locally
docker build -t davidtang-ai .

# Run container locally
docker run -p 8080:8080 davidtang-ai
```

## Deployment

### Manual Deployment
1. Update `PROJECT_ID` in `deploy.sh`
2. Run: `./deploy.sh`

### Automated Deployment (Cloud Build)
1. Set up Cloud Build trigger pointing to this repository
2. Cloud Build will use `cloudbuild.yaml` for automated deployment

## File Structure

- `main.go` - Go HTTP server that serves static SPA assets
- `src/App.svelte` - Main Svelte component; renders profile, CTA, YouTube, and LinkedIn sections
- `src/main.js` - Svelte application entry point
- `src/app.css` - Tailwind CSS imports
- `public/content.json` - JSON content source for YouTube + LinkedIn (copied to `dist/`)
- `CONTENT_PIPELINE.md` - Details the JSON schema and Cloud Scheduler/GCS plan
- `dist/` - Built Svelte application (generated by `npm run build`)
- `Dockerfile` - Multi-stage build for containerization

## Configuration Notes

- Server runs on port 8080 (required for Cloud Run)
- Cloud Run deploy flags (see `cloudbuild.yaml`): `--memory 256Mi`, `--cpu 0.5`, `--max-instances 1`, `--ingress internal-and-cloud-load-balancing`, port `8080`
- Application serves from `/dist` directory
- Dynamic content URL is `"/content.json"` by default; switch to a GCS URL for runtime content updates without redeploy

## Content & Design

- The SPA reads a small JSON file to populate dynamic sections. See `CONTENT_PIPELINE.md` for full details and schema. Key fields:
  - `youtube.featuredVideoId` and `youtube.videos[]` (id, title, thumbnailUrl, url)
  - `linkedin.embedIframeSrc` (official LinkedIn embed iframe src), `linkedin.postUrl`
- YouTube: shows featured video as a thumbnail that click-to-plays (`youtube-nocookie.com`) and two additional recent videos as thumbnails.
- LinkedIn: renders a single embedded post via the provided iframe src.
- Primary CTA: "Work with Tangible" → `https://tangible.healthcare`.

### Switching content source to GCS
- Put generated JSON at `https://storage.googleapis.com/<bucket>/content.json` and update `CONTENT_URL` in `src/App.svelte` accordingly.
- Configure bucket CORS to allow GETs from `https://davidtang.ai`.

### Cloud Scheduler (summary)
- A scheduled Cloud Function/Run job queries YouTube Data API v3, assembles the JSON, and writes to GCS with cache headers. LinkedIn iframe src is usually curated manually.